// Collected on Intel i7-11800H laptop with 2-channel 16GB DDR4 3200MHz
// theoretical bandwidth 50GiB/s; AIDA64 shows 40GiB/s copy; 33.3GiB/s here
// compiled with clang 20.1.8; gcc15 seems to generate slower code
// clang -O2 -fopenmp -mavx512vbmi -mavx512vl -mlzcnt -D__DMM_XFERTBL_MAIN \
//   cgo/interleaveAnalytical-mramxfer.c -o a.out

// 2 threads
unsigned mramHToD[21][80] = {
  [0] = { // 32 bytes per DPU
    10, 12, 14, 15, 16, 17, 18, 19,
    20, 21, 22, 24, 25, 26, 27, 28,
    29, 30, 31, 32, 33, 34, 35, 36,
    37, 39, 40, 41, 42, 43, 44, 45,
    46, 47, 48, 49, 50, 51, 52, 53,
    54, 55, 56, 57, 58, 59, 60, 61,
    62, 63, 64, 65, 66, 67, 68, 69,
    70, 71, 72, 73, 74, 75, 76, 77,
    78, 79, 80, 81, 83, 84, 85, 86,
    87, 88, 89, 90, 91, 92, 93, 94,
  }, [1] = { // 64 bytes per DPU
    1, 2, 3, 4, 5, 6, 7, 8,
    9, 10, 11, 12, 13, 14, 15, 16,
    17, 18, 19, 20, 21, 22, 23, 24,
    25, 26, 27, 28, 29, 30, 31, 32,
    33, 34, 35, 36, 37, 38, 39, 40,
    41, 42, 43, 44, 45, 46, 47, 48,
    49, 50, 51, 52, 53, 54, 55, 56,
    57, 58, 59, 60, 61, 62, 63, 64,
    65, 66, 67, 68, 69, 70, 71, 72,
    73, 74, 75, 76, 77, 78, 79, 80,
  }, [2] = { // 128 bytes per DPU
    2, 3, 5, 7, 9, 11, 13, 15,
    17, 19, 21, 23, 25, 27, 29, 31,
    33, 34, 36, 38, 40, 42, 44, 46,
    48, 50, 51, 53, 55, 57, 59, 60,
    61, 63, 64, 66, 67, 69, 71, 72,
    73, 75, 77, 79, 80, 82, 84, 86,
    88, 90, 92, 94, 96, 98, 100, 102,
    104, 106, 108, 110, 112, 113, 115, 116,
    118, 120, 122, 124, 126, 128, 130, 132,
    134, 135, 136, 138, 140, 142, 144, 146,
  }, [3] = { // 256 bytes per DPU
    2, 4, 6, 8, 10, 12, 14, 16,
    18, 20, 22, 24, 26, 28, 30, 32,
    34, 36, 38, 40, 42, 44, 46, 48,
    50, 52, 54, 56, 58, 60, 62, 64,
    66, 68, 70, 72, 74, 76, 78, 80,
    82, 84, 86, 88, 90, 92, 94, 96,
    98, 100, 102, 104, 106, 108, 110, 112,
    114, 116, 118, 120, 122, 124, 126, 128,
    130, 132, 134, 136, 138, 140, 142, 144,
    146, 148, 150, 152, 154, 156, 158, 160,
  }, [4] = { // 512 bytes per DPU
    2, 4, 6, 8, 10, 12, 14, 16,
    18, 20, 22, 24, 26, 28, 30, 32,
    34, 36, 38, 40, 42, 44, 46, 48,
    50, 52, 54, 56, 58, 60, 62, 64,
    66, 68, 70, 72, 74, 76, 78, 80,
    82, 84, 86, 88, 90, 92, 94, 96,
    98, 100, 102, 104, 106, 108, 110, 112,
    114, 116, 118, 120, 122, 124, 126, 128,
    130, 132, 134, 136, 138, 140, 142, 144,
    146, 148, 150, 152, 154, 156, 158, 160,
  }, [5] = { // 1024 bytes per DPU
    2, 4, 6, 8, 10, 12, 14, 16,
    18, 20, 22, 24, 26, 28, 30, 32,
    34, 36, 38, 40, 42, 44, 46, 48,
    50, 52, 54, 56, 58, 60, 62, 64,
    66, 68, 70, 72, 74, 76, 78, 80,
    82, 84, 86, 88, 90, 92, 94, 96,
    98, 100, 102, 104, 106, 108, 110, 112,
    114, 116, 118, 120, 122, 124, 126, 128,
    130, 132, 170, 173, 190, 192, 194, 196,
    198, 200, 202, 204, 216, 218, 220, 222,
  }, [6] = { // 2048 bytes per DPU
    3, 6, 9, 12, 15, 18, 21, 24,
    27, 30, 33, 36, 39, 50, 53, 56,
    59, 62, 65, 68, 71, 74, 77, 80,
    83, 86, 89, 92, 95, 98, 101, 104,
    107, 110, 113, 115, 118, 121, 124, 127,
    130, 133, 136, 139, 142, 145, 148, 151,
    154, 157, 160, 163, 166, 169, 172, 175,
    178, 181, 184, 186, 189, 192, 195, 197,
    200, 203, 206, 209, 212, 214, 217, 220,
    223, 226, 229, 232, 235, 238, 241, 244,
  }, [7] = { // 4096 bytes per DPU
    4, 8, 12, 16, 20, 24, 28, 32,
    36, 40, 44, 48, 52, 56, 60, 64,
    68, 72, 76, 80, 84, 88, 92, 96,
    100, 104, 108, 112, 116, 120, 124, 128,
    132, 136, 140, 144, 148, 152, 156, 160,
    164, 168, 172, 176, 180, 184, 188, 192,
    196, 200, 204, 208, 212, 216, 220, 224,
    228, 232, 236, 240, 244, 248, 252, 256,
    260, 264, 268, 272, 276, 280, 284, 288,
    292, 296, 300, 304, 308, 312, 316, 320,
  }, [8] = { // 8192 bytes per DPU
    9, 16, 24, 32, 39, 46, 53, 59,
    66, 73, 81, 88, 94, 101, 108, 114,
    121, 128, 135, 143, 149, 155, 161, 167,
    174, 180, 188, 195, 202, 209, 215, 221,
    228, 234, 241, 247, 254, 297, 322, 329,
    346, 353, 360, 367, 374, 380, 387, 393,
    399, 406, 413, 420, 426, 433, 440, 446,
    453, 460, 467, 474, 481, 487, 494, 501,
    507, 513, 520, 527, 534, 540, 546, 553,
    559, 565, 572, 579, 586, 592, 599, 605,
  }, [9] = { // 16384 bytes per DPU
    16, 29, 42, 54, 66, 79, 94, 107,
    119, 131, 144, 158, 173, 189, 204, 218,
    233, 250, 266, 281, 296, 313, 330, 345,
    360, 376, 390, 405, 421, 436, 450, 466,
    481, 495, 508, 523, 539, 554, 571, 625,
    656, 669, 681, 694, 709, 723, 748, 761,
    775, 789, 803, 818, 834, 847, 861, 877,
    892, 906, 921, 937, 952, 966, 980, 995,
    1010, 1025, 1039, 1054, 1068, 1083, 1097, 1112,
    1127, 1142, 1156, 1172, 1188, 1202, 1217, 1233,
  }, [10] = { // 32768 bytes per DPU
    36, 64, 92, 120, 148, 179, 207, 236,
    264, 298, 377, 415, 443, 473, 501, 530,
    556, 584, 614, 642, 671, 699, 726, 754,
    782, 810, 840, 867, 895, 923, 951, 977,
    1005, 1032, 1061, 1089, 1118, 1144, 1171, 1199,
    1228, 1258, 1287, 1352, 1378, 1406, 1437, 1471,
    1500, 1530, 1562, 1593, 1623, 1653, 1681, 1714,
    1750, 1799, 1834, 1870, 1906, 1942, 1977, 2014,
    2048, 2081, 2116, 2151, 2185, 2230, 2262, 2334,
    2364, 2390, 2426, 2459, 2492, 2524, 2556, 2588,
  }, [11] = { // 65536 bytes per DPU
    84, 146, 206, 266, 335, 407, 463, 520,
    585, 657, 753, 820, 918, 991, 1045, 1113,
    1180, 1254, 1320, 1384, 1457, 1532, 1602, 1670,
    1761, 1835, 1910, 1976, 2041, 2106, 2170, 2232,
    2315, 2398, 2478, 2552, 2647, 2736, 2812, 2889,
    2973, 3049, 3144, 3210, 3291, 3355, 3422, 3485,
    3549, 3613, 3687, 3758, 3812, 3866, 3922, 3978,
    4030, 4085, 4147, 4203, 4259, 4316, 4369, 4442,
    4503, 4564, 4618, 4682, 4750, 4808, 4868, 4921,
    4973, 5029, 5078, 5126, 5188, 5242, 5293, 5347,
  }, [12] = { // 131072 bytes per DPU
    154, 264, 393, 527, 637, 744, 851, 961,
    1071, 1180, 1294, 1428, 1539, 1649, 1763, 1877,
    1987, 2099, 2209, 2324, 2442, 2548, 2655, 2767,
    2881, 3009, 3130, 3235, 3378, 3479, 3585, 3692,
    3797, 3905, 4010, 4123, 4230, 4358, 4471, 4571,
    4673, 4773, 4871, 4973, 5085, 5193, 5300, 5403,
    5512, 5620, 5727, 5830, 5936, 6040, 6158, 6282,
    6389, 6498, 6598, 6701, 6809, 6916, 7029, 7143,
    7257, 7451, 7572, 7702, 7825, 7958, 8065, 8169,
    8317, 8449, 8556, 8671, 8813, 8933, 9076, 9210,
  }, [13] = { // 262144 bytes per DPU
    331, 597, 842, 1105, 1373, 1616, 1869, 2150,
    2377, 2585, 2798, 3017, 3260, 3475, 3703, 3941,
    4222, 4505, 4766, 5006, 5260, 5473, 5683, 5894,
    6115, 6332, 6549, 6759, 6975, 7209, 7441, 7671,
    7882, 8108, 8330, 8548, 8765, 8985, 9210, 9429,
    9641, 9868, 10090, 10302, 10516, 10735, 10953, 11171,
    11389, 11609, 11830, 12055, 12264, 12481, 12699, 12918,
    13146, 13363, 13576, 13791, 14006, 14234, 14453, 14660,
    14876, 15105, 15325, 15540, 15759, 15969, 16191, 16409,
    16619, 16843, 17077, 17306, 17545, 17787, 18033, 18266,
  }, [14] = { // 524288 bytes per DPU
    929, 1480, 2025, 2543, 3116, 3622, 4208, 4819,
    5368, 5906, 6406, 6907, 7410, 7934, 8433, 8950,
    9448, 9966, 10500, 11108, 11675, 12206, 12730, 13248,
    13776, 14241, 14635, 15038, 15437, 15841, 16248, 16654,
    17079, 17481, 17952, 18374, 18787, 19194, 19596, 20104,
    20574, 21058, 21682, 22258, 22850, 23374, 23809, 24204,
    24602, 25006, 25399, 25801, 26197, 26589, 26992, 27389,
    27790, 28188, 28583, 28985, 29382, 29783, 30181, 30580,
    30978, 31376, 31772, 32167, 32567, 33021, 33563, 34081,
    34579, 35081, 35572, 36056, 36532, 37019, 37512, 38116,
  }, [15] = { // 1048576 bytes per DPU
    1543, 2621, 3619, 4624, 5636, 6650, 7515, 8304,
    9094, 9895, 10693, 11541, 12683, 13749, 14804, 15844,
    16988, 18222, 19387, 20393, 21390, 22399, 23269, 24077,
    24879, 25696, 26478, 27307, 28167, 29483, 30599, 31614,
    32647, 33805, 34910, 35922, 36931, 37928, 38916, 39712,
    40489, 41285, 42072, 42878, 43680, 44478, 45484, 46756,
    47896, 48938, 50108, 51216, 52456, 53745, 55016, 55980,
    56792, 57590, 58378, 59195, 59976, 60759, 61648, 63085,
    64287, 65325, 66399, 67437, 68486, 69654, 70762, 71775,
    72661, 73452, 74244, 75038, 75828, 76617, 77399, 78252,
  }, [16] = { // 2097152 bytes per DPU
    3673, 5848, 7958, 9677, 11265, 12934, 14525, 16120,
    18616, 20999, 23148, 25343, 27550, 29530, 31139, 32875,
    35432, 37739, 39855, 41931, 44083, 45887, 47495, 49085,
    51295, 53835, 56211, 58301, 60377, 62057, 63655, 65236,
    67105, 69756, 72424, 74722, 76896, 78694, 80282, 81858,
    83683, 86487, 88706, 90836, 93053, 95007, 96684, 98278,
    100027, 102797, 105018, 107333, 109488, 111434, 113006, 114603,
    116262, 118864, 121270, 123620, 125669, 127701, 129302, 130894,
    132482, 134860, 137348, 139701, 141762, 143827, 145571, 147176,
    148777, 150853, 153578, 155841, 158009, 160269, 162056, 163635,
  }, [17] = { // 4194304 bytes per DPU
    7892, 14450, 21078, 29312, 35432, 43783, 50177, 57960,
    64636, 71332, 79191, 85387, 93662, 99855, 107275, 114192,
    120764, 128539, 134655, 142604, 149089, 156090, 163354, 169550,
    177469, 183687, 191192, 198077, 204534, 212386, 218502, 226531,
    232849, 240210, 247390, 253626, 261895, 267990, 276090, 282766,
    289943, 297252, 303614, 311501, 317593, 325254, 331954, 338890,
    346447, 352610, 360866, 367142, 374511, 382180, 388336, 394763,
    401893, 409228, 415820, 423732, 429936, 437694, 444305, 451470,
    458646, 465064, 473038, 479262, 487218, 493814, 501080, 508492,
    514734, 522830, 529099, 536950, 544322, 551888, 559056, 565694,
  }, [18] = { // 8388608 bytes per DPU
    15912, 32975, 50870, 69146, 85384, 101357, 117020, 132682,
    148525, 164521, 180598, 196600, 212522, 228628, 244628, 260723,
    276764, 292960, 308813, 324701, 340625, 356727, 372665, 388835,
    404675, 420504, 436544, 452361, 468041, 483719, 499125, 515008,
    530834, 546825, 562624, 578545, 594487, 610239, 626140, 642256,
    658382, 674448, 690420, 706437, 722465, 738809, 754869, 770904,
    787101, 802294, 816769, 832065, 846143, 861674, 875935, 889612,
    903105, 916819, 930717, 944438, 958045, 971700, 985300, 999064,
    1012772, 1026537, 1040647, 1054770, 1070024, 1084963, 1099019, 1112641,
    1126151, 1139845, 1153381, 1167560, 1181400, 1194943, 1208433, 1221995,
  }, [19] = { // 16777216 bytes per DPU
    29476, 59148, 88694, 118181, 147654, 177243, 206732, 236359,
    266049, 295865, 325676, 355259, 384899, 414412, 444047, 473722,
    503331, 533316, 562864, 593263, 623215, 653587, 683412, 713065,
    742844, 772686, 802218, 831791, 861549, 891394, 920916, 950534,
    980284, 1009963, 1039554, 1069180, 1098754, 1128504, 1158111, 1187772,
    1217340, 1246877, 1276558, 1306043, 1335775, 1365416, 1395004, 1424647,
    1454342, 1483972, 1513768, 1543275, 1572864, 1603736, 1633600, 1663340,
    1693380, 1723533, 1755686, 1786966, 1816594, 1846457, 1876391, 1905958,
    1935518, 1965048, 1994587, 2024136, 2053764, 2083325, 2112755, 2142269,
    2171805, 2201470, 2230930, 2260569, 2290219, 2320246, 2349780, 2379260,
  }, [20] = { // 33554432 bytes per DPU
    60463, 120865, 181394, 243144, 304129, 365036, 427312, 488182,
    548771, 609352, 669943, 730457, 791239, 851713, 912173, 973009,
    1033599, 1094208, 1154979, 1215835, 1276785, 1337681, 1398214, 1459014,
    1520036, 1580526, 1641055, 1701486, 1762198, 1822649, 1883117, 1943776,
    2004339, 2064740, 2125148, 2185734, 2247647, 2308700, 2369817, 2430319,
    2491294, 2551758, 2612396, 2672817, 2733401, 2793912, 2854738, 2915245,
    2975921, 3036400, 3096954, 3157440, 3218420, 3279523, 3340516, 3401153,
    3462068, 3522858, 3583432, 3643908, 3704376, 3764800, 3825254, 3885724,
    3946324, 4006932, 4067465, 4128072, 4188770, 4249650, 4310469, 4371004,
    4431442, 4492021, 4552789, 4613362, 4673746, 4734371, 4794941, 4855372,
  },
};

// 2 threads
unsigned mramDToH[21][80] = {
  [0] = { // 32 bytes per DPU
    10, 12, 14, 15, 16, 17, 18, 19,
    20, 21, 22, 24, 25, 26, 27, 28,
    29, 30, 31, 32, 33, 34, 35, 36,
    37, 39, 40, 41, 42, 43, 44, 45,
    46, 47, 48, 49, 50, 51, 52, 53,
    54, 55, 56, 57, 58, 59, 60, 61,
    62, 63, 64, 65, 66, 67, 68, 69,
    70, 71, 72, 73, 74, 75, 76, 77,
    78, 79, 80, 81, 83, 84, 85, 86,
    87, 88, 89, 90, 91, 92, 93, 94,
  }, [1] = { // 64 bytes per DPU
    2, 4, 5, 6, 7, 8, 9, 10,
    11, 12, 13, 14, 15, 16, 17, 18,
    19, 20, 21, 22, 23, 24, 25, 26,
    27, 28, 29, 30, 31, 32, 33, 34,
    35, 36, 37, 38, 39, 40, 41, 42,
    43, 44, 45, 46, 47, 48, 49, 50,
    51, 52, 54, 55, 56, 57, 58, 59,
    60, 61, 62, 63, 65, 66, 67, 68,
    69, 70, 71, 72, 73, 74, 75, 76,
    77, 78, 79, 80, 81, 82, 83, 84,
  }, [2] = { // 128 bytes per DPU
    2, 4, 6, 8, 10, 12, 14, 16,
    18, 20, 22, 24, 26, 28, 30, 32,
    34, 36, 38, 40, 42, 44, 46, 48,
    50, 52, 54, 56, 58, 60, 62, 64,
    66, 68, 70, 72, 74, 76, 78, 80,
    82, 84, 86, 88, 90, 92, 94, 96,
    98, 100, 102, 104, 106, 108, 110, 112,
    114, 116, 118, 120, 122, 124, 126, 128,
    130, 132, 134, 136, 138, 140, 142, 144,
    146, 148, 150, 152, 154, 156, 158, 160,
  }, [3] = { // 256 bytes per DPU
    2, 4, 6, 8, 10, 12, 14, 16,
    18, 20, 22, 24, 26, 28, 30, 32,
    34, 36, 38, 40, 42, 44, 46, 48,
    50, 52, 54, 56, 58, 60, 62, 64,
    66, 68, 70, 72, 74, 76, 78, 80,
    82, 84, 86, 88, 90, 92, 94, 96,
    98, 100, 102, 104, 106, 108, 110, 112,
    114, 116, 118, 120, 122, 124, 126, 128,
    130, 132, 134, 136, 138, 140, 142, 144,
    146, 148, 150, 152, 154, 156, 158, 160,
  }, [4] = { // 512 bytes per DPU
    2, 4, 6, 8, 10, 12, 14, 16,
    18, 20, 22, 24, 26, 28, 30, 32,
    34, 36, 38, 40, 42, 44, 46, 48,
    50, 52, 54, 56, 58, 60, 62, 64,
    66, 68, 70, 72, 74, 76, 78, 80,
    82, 84, 86, 88, 90, 92, 94, 96,
    98, 100, 102, 104, 106, 108, 110, 112,
    114, 116, 118, 120, 122, 124, 126, 128,
    130, 132, 134, 136, 138, 140, 142, 144,
    146, 148, 150, 152, 154, 156, 158, 160,
  }, [5] = { // 1024 bytes per DPU
    2, 4, 6, 8, 10, 12, 14, 16,
    18, 21, 23, 25, 27, 29, 31, 33,
    35, 38, 40, 43, 45, 48, 51, 53,
    55, 58, 60, 62, 64, 66, 68, 70,
    72, 75, 78, 80, 82, 85, 87, 89,
    91, 94, 96, 98, 100, 103, 106, 108,
    110, 112, 114, 117, 119, 121, 123, 126,
    128, 130, 132, 135, 137, 139, 141, 144,
    146, 148, 150, 152, 154, 156, 158, 160,
    162, 164, 166, 168, 170, 172, 174, 176,
  }, [6] = { // 2048 bytes per DPU
    4, 7, 10, 13, 16, 19, 22, 25,
    28, 31, 34, 37, 40, 43, 46, 49,
    52, 55, 58, 61, 64, 67, 70, 73,
    76, 79, 82, 85, 88, 91, 94, 97,
    100, 103, 106, 109, 112, 115, 118, 121,
    124, 127, 130, 133, 136, 139, 142, 145,
    148, 151, 154, 157, 160, 163, 166, 169,
    172, 175, 178, 181, 184, 187, 190, 193,
    196, 199, 202, 205, 208, 211, 214, 217,
    220, 223, 226, 229, 232, 235, 238, 241,
  }, [7] = { // 4096 bytes per DPU
    5, 10, 15, 20, 25, 30, 35, 40,
    45, 50, 55, 63, 68, 73, 78, 83,
    88, 93, 98, 103, 108, 113, 118, 123,
    128, 133, 138, 143, 148, 152, 157, 162,
    167, 172, 177, 182, 187, 192, 197, 201,
    206, 211, 216, 221, 226, 231, 236, 241,
    246, 251, 256, 261, 266, 271, 276, 281,
    286, 291, 296, 301, 306, 311, 316, 321,
    326, 331, 336, 341, 346, 351, 356, 361,
    366, 371, 376, 381, 386, 391, 396, 401,
  }, [8] = { // 8192 bytes per DPU
    10, 18, 26, 34, 42, 50, 58, 66,
    74, 82, 90, 98, 106, 114, 122, 130,
    138, 146, 154, 162, 170, 178, 186, 194,
    202, 210, 218, 226, 234, 242, 250, 258,
    266, 274, 282, 290, 298, 306, 314, 322,
    330, 338, 346, 354, 362, 370, 378, 386,
    394, 402, 410, 418, 426, 434, 442, 450,
    458, 466, 474, 482, 490, 498, 506, 514,
    522, 530, 538, 546, 554, 562, 570, 578,
    586, 594, 602, 610, 620, 628, 636, 644,
  }, [9] = { // 16384 bytes per DPU
    17, 30, 44, 57, 70, 83, 96, 109,
    123, 136, 149, 162, 175, 188, 202, 215,
    228, 241, 254, 268, 282, 295, 308, 321,
    334, 347, 360, 373, 387, 400, 413, 426,
    439, 453, 466, 480, 494, 507, 521, 534,
    547, 560, 573, 586, 599, 613, 626, 640,
    653, 667, 681, 694, 707, 720, 734, 748,
    761, 774, 787, 800, 813, 826, 839, 852,
    865, 878, 891, 904, 917, 932, 946, 960,
    974, 988, 1001, 1014, 1027, 1040, 1053, 1066,
  }, [10] = { // 32768 bytes per DPU
    34, 61, 88, 114, 141, 168, 195, 222,
    249, 275, 301, 328, 355, 382, 408, 435,
    461, 488, 516, 548, 577, 606, 636, 667,
    697, 723, 749, 775, 801, 828, 855, 881,
    907, 934, 961, 988, 1014, 1041, 1068, 1094,
    1121, 1148, 1174, 1201, 1228, 1254, 1280, 1306,
    1333, 1360, 1387, 1413, 1439, 1466, 1493, 1520,
    1547, 1573, 1600, 1627, 1654, 1680, 1707, 1733,
    1759, 1786, 1814, 1840, 1866, 1892, 1919, 1946,
    1973, 2000, 2027, 2054, 2081, 2107, 2134, 2160,
  }, [11] = { // 65536 bytes per DPU
    73, 127, 181, 235, 290, 344, 398, 452,
    506, 560, 614, 669, 723, 777, 833, 892,
    952, 1013, 1069, 1129, 1187, 1248, 1308, 1368,
    1429, 1488, 1548, 1607, 1686, 1754, 1815, 1877,
    1946, 2005, 2059, 2115, 2169, 2222, 2276, 2330,
    2383, 2437, 2490, 2544, 2598, 2661, 2725, 2790,
    2852, 2912, 2973, 3034, 3095, 3149, 3202, 3256,
    3310, 3364, 3418, 3472, 3526, 3580, 3635, 3690,
    3744, 3798, 3852, 3906, 3960, 4014, 4068, 4121,
    4175, 4229, 4283, 4337, 4391, 4445, 4498, 4552,
  }, [12] = { // 131072 bytes per DPU
    144, 247, 349, 452, 556, 658, 759, 862,
    964, 1067, 1171, 1274, 1378, 1479, 1582, 1685,
    1788, 1890, 1992, 2092, 2192, 2293, 2396, 2499,
    2601, 2704, 2806, 2908, 3011, 3115, 3216, 3319,
    3420, 3522, 3625, 3728, 3830, 3933, 4036, 4139,
    4241, 4343, 4446, 4547, 4649, 4752, 4856, 4958,
    5065, 5166, 5268, 5371, 5473, 5575, 5677, 5778,
    5880, 5983, 6086, 6187, 6289, 6391, 6492, 6595,
    6697, 6799, 6902, 7007, 7111, 7213, 7317, 7420,
    7522, 7625, 7726, 7829, 7931, 8033, 8135, 8236,
  }, [13] = { // 262144 bytes per DPU
    287, 494, 700, 906, 1113, 1317, 1523, 1731,
    1938, 2142, 2347, 2554, 2764, 2968, 3169, 3375,
    3580, 3786, 3988, 4193, 4401, 4618, 4827, 5033,
    5238, 5441, 5647, 5855, 6059, 6268, 6476, 6682,
    6887, 7092, 7297, 7502, 7708, 7913, 8116, 8321,
    8524, 8730, 8934, 9137, 9344, 9552, 9758, 9965,
    10171, 10376, 10584, 10803, 11035, 11241, 11445, 11650,
    11858, 12060, 12267, 12492, 12723, 12968, 13195, 13421,
    13648, 13886, 14093, 14299, 14507, 14710, 14918, 15123,
    15327, 15533, 15744, 15948, 16153, 16358, 16566, 16772,
  }, [14] = { // 524288 bytes per DPU
    638, 1056, 1471, 1892, 2307, 2721, 3147, 3564,
    3975, 4403, 4818, 5237, 5656, 6082, 6498, 6921,
    7330, 7748, 8165, 8589, 9015, 9429, 9850, 10264,
    10688, 11102, 11524, 11944, 12368, 12788, 13265, 13683,
    14101, 14516, 14933, 15364, 15781, 16200, 16622, 17043,
    17465, 17874, 18290, 18704, 19124, 19549, 19963, 20399,
    20814, 21234, 21651, 22073, 22497, 22918, 23335, 23756,
    24176, 24593, 25017, 25431, 25845, 26263, 26681, 27096,
    27509, 27932, 28349, 28771, 29187, 29604, 30025, 30443,
    30854, 31271, 31693, 32112, 32528, 32949, 33370, 33789,
  }, [15] = { // 1048576 bytes per DPU
    1236, 2048, 2886, 3719, 4537, 5379, 6207, 7074,
    8079, 9141, 10265, 11235, 12320, 13488, 14619, 15632,
    16617, 17519, 18492, 19549, 20549, 21696, 22851, 23885,
    24855, 25933, 27053, 28154, 29271, 30475, 31605, 32673,
    33696, 34706, 35624, 36611, 37630, 39036, 40027, 41155,
    42213, 43216, 44226, 45331, 46500, 47710, 48782, 49819,
    50878, 51865, 52723, 53575, 54507, 55432, 56339, 57169,
    58032, 58870, 59729, 60591, 61496, 62376, 63307, 64295,
    65517, 66550, 67393, 68243, 69080, 69925, 70782, 71719,
    72685, 73763, 74833, 75885, 76948, 78124, 79340, 80392,
  }, [16] = { // 2097152 bytes per DPU
    2684, 4412, 6277, 8493, 10759, 12935, 15261, 17383,
    19800, 21744, 23561, 25891, 28255, 30436, 32660, 35002,
    36974, 38755, 40557, 42935, 45192, 47532, 49853, 51999,
    53891, 55622, 57417, 59628, 62205, 64633, 66935, 69217,
    70954, 72732, 74582, 76931, 79402, 81900, 84132, 86219,
    87946, 89693, 91686, 94094, 96603, 99156, 101408, 103363,
    105095, 106986, 109020, 111644, 114133, 116455, 118693, 120482,
    122207, 124140, 126421, 129191, 131834, 134037, 136210, 137939,
    139671, 141615, 143762, 146431, 148834, 151103, 153492, 155410,
    157236, 159034, 161030, 163113, 165297, 167021, 168763, 170498,
  }, [17] = { // 4194304 bytes per DPU
    8193, 15415, 22804, 30111, 36284, 44860, 50909, 59036,
    65278, 72795, 79886, 85785, 94133, 100114, 108688, 115199,
    122690, 129755, 135659, 144197, 150139, 158467, 164832, 172157,
    179278, 185074, 193352, 199402, 207232, 213730, 219980, 228248,
    234243, 242458, 248644, 256267, 263369, 270561, 279046, 285280,
    293741, 299863, 307893, 314181, 321012, 328538, 334423, 342837,
    349211, 357254, 363858, 370527, 378193, 384251, 392408, 398501,
    405953, 412690, 418477, 427770, 434028, 442297, 449426, 457626,
    464372, 471522, 479141, 485099, 493572, 499611, 507834, 514025,
    520637, 528482, 534344, 542546, 548670, 556468, 563169, 569258,
  }, [18] = { // 8388608 bytes per DPU
    16616, 32510, 48809, 65832, 82446, 98600, 115096, 131394,
    147756, 163847, 179935, 196102, 212196, 228207, 244371, 260468,
    276601, 292665, 308887, 324886, 341015, 357284, 373640, 390443,
    406392, 422830, 438896, 455011, 471478, 487370, 503026, 518957,
    534758, 550337, 566055, 582106, 598134, 614372, 630624, 646842,
    662938, 679138, 695319, 711399, 727444, 743938, 760290, 776323,
    792619, 808885, 824967, 841043, 857126, 873288, 889562, 905749,
    921790, 937605, 953460, 969289, 984901, 1000670, 1016408, 1032402,
    1048520, 1064764, 1081118, 1097506, 1113622, 1129793, 1146297, 1162651,
    1179122, 1195999, 1211797, 1227376, 1242034, 1256188, 1270339, 1284310,
  }, [19] = { // 16777216 bytes per DPU
    29707, 59602, 89071, 120632, 150991, 180752, 210484, 240150,
    269724, 299112, 328421, 357728, 387205, 416478, 446365, 475681,
    505046, 534455, 563546, 592699, 621946, 651312, 680409, 709555,
    738687, 767811, 797107, 826312, 860921, 891267, 921484, 951760,
    981586, 1011347, 1041043, 1070929, 1100589, 1131698, 1161547, 1191285,
    1221000, 1250654, 1280051, 1309450, 1338633, 1367823, 1397031, 1426259,
    1455355, 1484390, 1514078, 1543217, 1572154, 1601168, 1630162, 1659144,
    1688273, 1717427, 1746407, 1775427, 1804651, 1833696, 1862904, 1892047,
    1920993, 1950302, 1979381, 2008474, 2037567, 2066516, 2095531, 2125138,
    2154228, 2183383, 2212301, 2241367, 2270401, 2299323, 2328422, 2358223,
  }, [20] = { // 33554432 bytes per DPU
    60847, 121784, 182517, 243175, 303687, 364289, 424923, 485743,
    546466, 607371, 668308, 729292, 791266, 852540, 913503, 974208,
    1034925, 1095484, 1156237, 1216818, 1277565, 1338300, 1398791, 1459280,
    1519671, 1580264, 1640594, 1700988, 1762245, 1827754, 1891263, 1952873,
    2013726, 2074768, 2135328, 2195892, 2256471, 2317229, 2377892, 2438344,
    2499622, 2560335, 2620588, 2681264, 2741349, 2802720, 2863989, 2924849,
    2985663, 3046314, 3106691, 3167249, 3227661, 3288089, 3348555, 3408516,
    3469003, 3529696, 3590584, 3650940, 3711738, 3772925, 3834338, 3894915,
    3955396, 4016029, 4076469, 4136667, 4197252, 4257898, 4318579, 4378563,
    4438668, 4498851, 4559348, 4619467, 4679941, 4739977, 4800778, 4861007,
  },
};

// 2 threads
unsigned mramHToDBcst[21][80] = {
  [0] = { // 32 bytes per DPU
    10, 12, 13, 14, 15, 16, 17, 18,
    19, 20, 21, 24, 25, 26, 27, 28,
    29, 30, 31, 32, 33, 34, 35, 36,
    37, 38, 39, 40, 41, 42, 43, 44,
    45, 46, 47, 48, 49, 50, 51, 52,
    53, 54, 55, 56, 57, 58, 59, 60,
    61, 62, 63, 64, 65, 66, 67, 68,
    69, 70, 71, 72, 73, 74, 75, 76,
    77, 78, 79, 80, 81, 82, 83, 84,
    85, 86, 87, 88, 89, 90, 91, 92,
  }, [1] = { // 64 bytes per DPU
    2, 4, 6, 8, 10, 12, 14, 16,
    18, 20, 22, 24, 26, 28, 30, 32,
    34, 36, 38, 40, 42, 44, 46, 48,
    50, 52, 54, 56, 58, 60, 62, 64,
    66, 68, 70, 72, 74, 76, 78, 80,
    82, 84, 86, 88, 90, 92, 94, 96,
    98, 100, 102, 104, 106, 108, 110, 112,
    114, 116, 118, 120, 122, 124, 126, 128,
    130, 132, 134, 136, 138, 140, 142, 144,
    146, 148, 150, 152, 154, 156, 158, 160,
  }, [2] = { // 128 bytes per DPU
    2, 4, 6, 8, 10, 12, 14, 16,
    18, 20, 22, 26, 28, 30, 32, 34,
    36, 38, 40, 42, 44, 46, 48, 50,
    52, 54, 56, 58, 60, 62, 64, 66,
    68, 70, 72, 74, 76, 78, 80, 82,
    84, 86, 88, 90, 92, 94, 96, 98,
    100, 102, 104, 106, 108, 110, 112, 114,
    116, 118, 120, 122, 124, 126, 128, 130,
    132, 134, 136, 138, 140, 142, 144, 146,
    148, 150, 152, 154, 156, 158, 160, 162,
  }, [3] = { // 256 bytes per DPU
    2, 4, 6, 8, 10, 12, 14, 16,
    18, 20, 22, 24, 26, 28, 30, 32,
    34, 36, 38, 40, 42, 44, 46, 48,
    50, 52, 54, 56, 58, 60, 62, 64,
    66, 68, 70, 72, 74, 76, 78, 80,
    82, 84, 86, 88, 90, 92, 94, 96,
    98, 100, 102, 104, 106, 108, 110, 112,
    114, 116, 118, 120, 122, 124, 126, 128,
    130, 132, 134, 136, 138, 140, 142, 144,
    146, 148, 150, 152, 154, 156, 158, 160,
  }, [4] = { // 512 bytes per DPU
    2, 4, 6, 8, 10, 12, 14, 16,
    18, 20, 22, 24, 26, 28, 30, 32,
    34, 36, 38, 40, 42, 44, 46, 48,
    50, 52, 54, 56, 58, 60, 62, 64,
    66, 68, 70, 72, 74, 76, 78, 80,
    82, 84, 86, 88, 90, 92, 94, 96,
    98, 100, 102, 104, 106, 108, 110, 112,
    114, 116, 118, 120, 122, 124, 126, 128,
    130, 132, 134, 136, 138, 140, 142, 144,
    146, 148, 150, 152, 154, 156, 158, 160,
  }, [5] = { // 1024 bytes per DPU
    2, 4, 6, 8, 10, 12, 14, 16,
    18, 20, 22, 24, 26, 28, 30, 32,
    34, 36, 38, 40, 42, 44, 46, 48,
    50, 52, 54, 56, 58, 60, 62, 64,
    66, 68, 70, 72, 74, 76, 78, 80,
    82, 84, 86, 88, 90, 92, 94, 96,
    98, 100, 102, 104, 106, 108, 110, 112,
    114, 116, 118, 120, 122, 124, 126, 128,
    130, 132, 134, 136, 138, 140, 142, 144,
    146, 148, 150, 152, 154, 156, 158, 160,
  }, [6] = { // 2048 bytes per DPU
    3, 6, 9, 12, 15, 27, 30, 33,
    36, 39, 42, 45, 48, 51, 54, 57,
    60, 63, 66, 69, 72, 75, 78, 81,
    84, 87, 90, 93, 96, 99, 102, 105,
    108, 111, 114, 117, 120, 123, 126, 129,
    132, 135, 138, 141, 144, 147, 150, 153,
    156, 159, 162, 165, 168, 171, 174, 177,
    180, 183, 186, 189, 192, 195, 198, 201,
    204, 207, 210, 213, 217, 220, 223, 226,
    229, 232, 235, 238, 241, 244, 247, 250,
  }, [7] = { // 4096 bytes per DPU
    4, 8, 12, 16, 20, 24, 28, 32,
    36, 40, 44, 48, 52, 56, 60, 64,
    68, 72, 76, 80, 84, 88, 92, 96,
    100, 104, 108, 112, 117, 121, 125, 129,
    133, 137, 141, 145, 149, 153, 157, 161,
    165, 169, 173, 177, 181, 185, 189, 193,
    197, 201, 205, 209, 213, 217, 221, 225,
    229, 233, 237, 241, 245, 249, 253, 257,
    261, 265, 269, 273, 277, 281, 285, 289,
    293, 297, 301, 305, 309, 313, 317, 321,
  }, [8] = { // 8192 bytes per DPU
    7, 14, 21, 28, 34, 41, 48, 55,
    62, 69, 76, 83, 90, 97, 104, 111,
    118, 125, 132, 139, 145, 152, 159, 166,
    173, 179, 186, 193, 200, 207, 214, 220,
    227, 234, 241, 248, 255, 262, 268, 274,
    281, 288, 295, 302, 309, 315, 322, 329,
    336, 343, 349, 356, 363, 370, 377, 384,
    391, 397, 403, 410, 417, 424, 431, 438,
    444, 451, 458, 465, 472, 486, 493, 500,
    507, 514, 520, 527, 533, 540, 547, 554,
  }, [9] = { // 16384 bytes per DPU
    14, 26, 39, 51, 63, 76, 88, 100,
    112, 124, 136, 149, 161, 173, 185, 197,
    209, 221, 233, 245, 257, 269, 281, 293,
    305, 317, 329, 341, 353, 365, 377, 389,
    401, 413, 425, 437, 449, 461, 473, 485,
    497, 509, 521, 533, 545, 557, 569, 581,
    593, 605, 617, 629, 641, 653, 665, 677,
    689, 701, 713, 725, 737, 749, 761, 773,
    785, 797, 809, 821, 833, 845, 857, 869,
    881, 893, 905, 917, 929, 941, 953, 965,
  }, [10] = { // 32768 bytes per DPU
    25, 48, 70, 93, 117, 140, 163, 186,
    209, 232, 255, 278, 301, 324, 347, 370,
    393, 416, 439, 462, 485, 508, 531, 554,
    577, 600, 623, 646, 669, 692, 715, 738,
    764, 790, 816, 841, 865, 888, 911, 934,
    957, 980, 1005, 1028, 1051, 1074, 1097, 1120,
    1143, 1167, 1190, 1213, 1236, 1259, 1282, 1305,
    1328, 1351, 1374, 1397, 1420, 1443, 1466, 1489,
    1512, 1535, 1558, 1581, 1604, 1627, 1650, 1673,
    1696, 1719, 1742, 1765, 1788, 1811, 1834, 1857,
  }, [11] = { // 65536 bytes per DPU
    51, 98, 146, 193, 240, 287, 333, 380,
    426, 472, 519, 565, 611, 657, 707, 764,
    816, 871, 924, 978, 1032, 1086, 1140, 1218,
    1274, 1331, 1384, 1442, 1496, 1552, 1606, 1657,
    1710, 1763, 1818, 1874, 1927, 1979, 2035, 2088,
    2183, 2257, 2323, 2382, 2437, 2487, 2540, 2593,
    2642, 2697, 2748, 2802, 2854, 2905, 2967, 3014,
    3060, 3109, 3156, 3202, 3249, 3295, 3341, 3388,
    3434, 3480, 3526, 3572, 3618, 3664, 3711, 3757,
    3810, 3855, 3901, 3947, 3994, 4040, 4088, 4135,
  }, [12] = { // 131072 bytes per DPU
    101, 194, 287, 380, 473, 566, 659, 752,
    845, 938, 1046, 1139, 1232, 1325, 1418, 1511,
    1604, 1696, 1789, 1882, 1976, 2070, 2162, 2255,
    2348, 2441, 2534, 2627, 2720, 2812, 2905, 3002,
    3097, 3190, 3283, 3376, 3469, 3562, 3655, 3747,
    3840, 3933, 4028, 4121, 4213, 4306, 4399, 4492,
    4585, 4678, 4771, 4865, 4960, 5053, 5146, 5239,
    5332, 5425, 5518, 5611, 5703, 5796, 5889, 5983,
    6077, 6170, 6263, 6356, 6449, 6542, 6634, 6727,
    6820, 6913, 7007, 7101, 7194, 7287, 7380, 7473,
  }, [13] = { // 262144 bytes per DPU
    200, 386, 573, 760, 946, 1133, 1321, 1515,
    1701, 1886, 2073, 2259, 2446, 2632, 2818, 3004,
    3190, 3375, 3563, 3750, 3936, 4122, 4308, 4495,
    4681, 4866, 5052, 5237, 5424, 5610, 5797, 5987,
    6182, 6386, 6648, 6837, 7024, 7211, 7398, 7586,
    7772, 7957, 8143, 8330, 8518, 8705, 8891, 9077,
    9262, 9449, 9636, 9822, 10007, 10193, 10379, 10567,
    10753, 10939, 11125, 11311, 11500, 11701, 11888, 12074,
    12261, 12454, 12641, 12827, 13013, 13199, 13386, 13573,
    13759, 13944, 14131, 14323, 14509, 14696, 14882, 15068,
  }, [14] = { // 524288 bytes per DPU
    412, 788, 1165, 1543, 1924, 2298, 2684, 3059,
    3439, 3819, 4195, 4575, 4951, 5323, 5715, 6090,
    6471, 6846, 7225, 7620, 8054, 8455, 8841, 9217,
    9599, 9975, 10354, 10728, 11102, 11477, 11859, 12235,
    12615, 12990, 13387, 13772, 14178, 14563, 14938, 15323,
    15700, 16075, 16451, 16828, 17204, 17601, 17979, 18357,
    18733, 19105, 19484, 19859, 20247, 20632, 21007, 21387,
    21768, 22166, 22579, 22969, 23366, 23747, 24127, 24519,
    24962, 25352, 25742, 26115, 26491, 26866, 27250, 27626,
    28008, 28393, 28768, 29143, 29519, 29896, 30275, 30675,
  }, [15] = { // 1048576 bytes per DPU
    831, 1578, 2323, 3069, 3826, 4570, 5317, 6064,
    6814, 7557, 8319, 9068, 9815, 10561, 11335, 12103,
    12873, 13688, 14673, 15503, 16329, 17229, 18035, 18897,
    19907, 20727, 21616, 22546, 23452, 24418, 25375, 26279,
    27291, 28339, 29367, 30410, 31436, 32282, 33125, 33927,
    34760, 35569, 36439, 37367, 38231, 39046, 39838, 40613,
    41377, 42167, 42984, 43858, 44846, 45897, 46804, 47702,
    48680, 49505, 50424, 51378, 52304, 53245, 54185, 55152,
    56193, 57224, 58154, 59060, 59979, 60969, 61798, 62563,
    63347, 64236, 65032, 65823, 66663, 67706, 68888, 69904,
  }, [16] = { // 2097152 bytes per DPU
    1938, 3698, 5541, 7592, 9373, 11214, 13433, 15210,
    16942, 18677, 20405, 22269, 24028, 25786, 27667, 29576,
    31327, 33136, 34862, 36560, 38346, 40042, 41657, 43316,
    45264, 47086, 48882, 50614, 52372, 54176, 55943, 57726,
    59547, 61585, 63470, 65257, 66998, 68584, 70140, 71638,
    73249, 74910, 76529, 78542, 80338, 82122, 83864, 85615,
    87332, 89104, 90862, 92769, 94703, 96519, 98269, 99893,
    101431, 102977, 104478, 106080, 107634, 109210, 111109, 112935,
    114719, 116432, 118187, 119951, 121628, 123397, 125342, 127294,
    129085, 130862, 132453, 134017, 135602, 137140, 138681, 140246,
  }, [17] = { // 4194304 bytes per DPU
    3804, 7501, 11068, 14578, 18608, 22287, 26072, 29619,
    33205, 37096, 40716, 43960, 47088, 50450, 53997, 57777,
    61767, 65378, 69289, 73126, 76801, 80362, 83989, 87948,
    91548, 95314, 98923, 102574, 106473, 109979, 113150, 116325,
    119689, 123420, 127084, 130662, 134653, 138195, 142033, 145647,
    149211, 153265, 156976, 160758, 164432, 168142, 171974, 176007,
    179284, 182432, 185727, 189454, 193200, 196800, 200700, 204362,
    208096, 211906, 215526, 219244, 223110, 226522, 229745, 232918,
    236260, 239937, 243634, 247146, 251148, 254774, 258635, 262284,
    265803, 269650, 273308, 276522, 279680, 282897, 286260, 290122,
  }, [18] = { // 8388608 bytes per DPU
    8499, 16368, 23643, 31388, 39705, 47640, 54654, 61094,
    68685, 77627, 85267, 93112, 100835, 107235, 114036, 121878,
    129595, 137110, 144384, 151946, 158307, 165289, 172745, 180405,
    187752, 195073, 202550, 208851, 215804, 223169, 230783, 238131,
    245381, 252813, 259062, 266620, 274038, 281868, 288831, 295310,
    302903, 310124, 317553, 324996, 332767, 339786, 346306, 354072,
    361774, 369280, 376445, 384017, 390635, 397484, 404791, 412347,
    419769, 426980, 434581, 440997, 447800, 455296, 462852, 470281,
    477807, 485299, 491577, 498783, 507254, 515983, 523783, 531443,
    538019, 544399, 551944, 559271, 566817, 574318, 584035, 591383,
  }, [19] = { // 16777216 bytes per DPU
    19215, 36455, 52886, 66684, 81806, 96382, 110445, 125829,
    138702, 154919, 168267, 183747, 197934, 212524, 227631, 241297,
    258115, 274026, 287372, 303380, 319274, 333639, 348586, 363083,
    377559, 392775, 405731, 422234, 438357, 452219, 467587, 484256,
    499191, 515516, 534092, 550109, 565057, 579815, 594611, 608167,
    624150, 640681, 654647, 670809, 686555, 701861, 718206, 733774,
    750053, 768044, 783945, 799731, 814452, 829824, 845474, 860508,
    875000, 890515, 906112, 921539, 936140, 951882, 967590, 981842,
    997593, 1013584, 1029321, 1044824, 1059486, 1075818, 1093503, 1110646,
    1126184, 1142123, 1157461, 1173111, 1187831, 1203138, 1218942, 1234515,
  }, [20] = { // 33554432 bytes per DPU
    38682, 78512, 118719, 155162, 187756, 219849, 252161, 284221,
    316389, 348219, 380067, 411828, 444080, 477424, 509507, 542005,
    574380, 606956, 638714, 670392, 702122, 733848, 765668, 797368,
    828962, 860669, 892321, 923918, 955726, 987295, 1018772, 1050592,
    1082254, 1113898, 1145495, 1177454, 1209430, 1241186, 1272928, 1304368,
    1335999, 1367668, 1399168, 1430516, 1464150, 1496330, 1528558, 1560721,
    1592588, 1624345, 1656223, 1688429, 1720361, 1752453, 1784479, 1816064,
    1847759, 1879231, 1910887, 1942415, 1973994, 2005434, 2036961, 2068569,
    2100380, 2131878, 2163544, 2195199, 2226787, 2258818, 2290650, 2322419,
    2353984, 2385867, 2417581, 2449368, 2481048, 2512730, 2545984, 2578044,
  },
};

#define _GNU_SOURCE
#include <immintrin.h>
#include <stdint.h>
#include <time.h>

extern uint32_t wramDToH[13][80], wramHToD[13][80], wramHToDBcst[13][80];
uint64_t DmmXferOverhead(size_t nrDpu, void *xferAddrs[], uint64_t xferSz, int ty) {
  const uint64_t highPos = 63 - _lzcnt_u64(xferSz), highBit = 1 << highPos;
  const uint64_t lowBits = xferSz ^ highBit;
  if (ty & 4) { // WRAM lookup table
    typeof(wramHToD) *lut;
    switch (ty & 3) {
    case 0: lut = &wramHToD; break;
    case 2: lut = &wramHToDBcst; break;
    case 1: case 3: lut = &wramDToH;
    }
    nrDpu = (nrDpu - 1) / 32;
    if (xferSz > 32768)
      return (*lut)[12][nrDpu] * xferSz / 32768;
    if (xferSz < 8)
      return (*lut)[0][nrDpu];
    return ((*lut)[highPos - 2][nrDpu] * lowBits +
            (*lut)[highPos - 3][nrDpu] * (highBit - lowBits)) >> highPos;
  }

  typeof(mramHToD) *lut;
  switch (ty & 3) {
  case 0: lut = &mramHToD; break;
  case 2: lut = &mramHToDBcst; break;
  case 1: case 3: lut = &mramDToH;
  }
  nrDpu = (nrDpu - 1) / 32;
  if (xferSz > 33554432)
    return (*lut)[20][nrDpu] * xferSz / 33554432;
  if (xferSz < 32)
    return (*lut)[0][nrDpu];
  return ((*lut)[highPos - 4][nrDpu] * lowBits +
          (*lut)[highPos - 5][nrDpu] * (highBit - lowBits)) >> highPos;
}
